*** Begin Patch
*** Add File: circl-backend/notifications/sender.py
+import json
+import subprocess
+from typing import Optional, Dict
+
+from .models import DeviceToken, SentNotification
+
+CERT_PATH_PROD = "/home/vullibhavin33_gmail_com/apns/apns-cert.pem"
+CERT_PATH_SANDBOX = "/home/vullibhavin33_gmail_com/apns/apns-cert-sandbox.pem"
+APNS_TOPIC = "com.fragne.circl"
+
+
+def send_apns_push(token: str, aps: Dict, custom: Optional[Dict] = None, use_prod: bool = True) -> Dict:
+    """
+    Send an APNs push using certificate-based curl (existing pattern). Returns a result dict.
+    """
+    body = {}
+    body.update(aps)
+    if custom:
+        body.update(custom)
+
+    payload_str = json.dumps(body)
+
+    cert = CERT_PATH_PROD if use_prod else CERT_PATH_SANDBOX
+
+    curl_cmd = [
+        "curl", "-v", "--http2",
+        "--cert", cert,
+        "-H", f"apns-topic: {APNS_TOPIC}",
+        "-H", "Content-Type: application/json",
+        "-d", payload_str,
+        f"https://api.push.apple.com/3/device/{token}"
+    ]
+
+    result = subprocess.run(curl_cmd, capture_output=True, text=True)
+
+    # Basic response parsing and token pruning
+    try:
+        status_code = result.returncode
+    except Exception:
+        status_code = -1
+
+    # If APNs indicates an invalid token remove/disable it
+    stderr = result.stderr or ""
+    if "410" in stderr or "Unregistered" in stderr:
+        try:
+            dt = DeviceToken.objects.filter(token=token).first()
+            if dt:
+                dt.is_active = False
+                dt.save()
+        except Exception:
+            pass
+
+    return {
+        "status_code": status_code,
+        "stdout": result.stdout,
+        "stderr": result.stderr
+    }
+
*** End Patch