*** Begin Patch
*** Update File: circl-backend/notifications/views.py
@@
-from django.views.decorators.csrf import csrf_exempt
-from django.http import JsonResponse
-import json
-from .models import DeviceToken
-from users.models import UserInfo
-
-@csrf_exempt
-def register_token(request):
-    if request.method == 'POST':
-        try:
-            data = json.loads(request.body)
-
-            token = data.get("token")
-            user_id = data.get("user_id")
-            is_production = data.get("is_production", False)
-
-            if not token or not user_id:
-                return JsonResponse({"error": "Missing token or user_id"}, status=400)
-
-            user = UserInfo.objects.get(id=user_id)
-
-            DeviceToken.objects.update_or_create(
-                token=token,
-                defaults={"user": user, "is_production": is_production}
-            )
-
-            return JsonResponse({"status": "success"}, status=201)
-
-        except Exception as e:
-            return JsonResponse({"error": str(e)}, status=500)
-
-    return JsonResponse({"error": "Invalid request method"}, status=405)
+from rest_framework.decorators import api_view, authentication_classes, permission_classes
+from rest_framework.authentication import TokenAuthentication
+from rest_framework.permissions import IsAuthenticated
+from rest_framework.response import Response
+from rest_framework import status
+import json
+from .models import DeviceToken
+
+
+@api_view(['POST'])
+@authentication_classes([TokenAuthentication])
+@permission_classes([IsAuthenticated])
+def register_token(request):
+    try:
+        data = request.data if hasattr(request, 'data') else json.loads(request.body)
+
+        token = data.get('token')
+        device_id = data.get('device_id')
+        platform = data.get('platform', 'ios')
+        app_version = data.get('app_version')
+        locale = data.get('locale')
+        is_production = data.get('is_production', False)
+
+        if not token:
+            return Response({'error': 'Missing token'}, status=status.HTTP_400_BAD_REQUEST)
+
+        user = request.user
+
+        DeviceToken.objects.update_or_create(
+            token=token,
+            defaults={
+                'user': user,
+                'device_id': device_id,
+                'platform': platform,
+                'app_version': app_version,
+                'locale': locale,
+                'is_production': is_production,
+                'is_active': True,
+            }
+        )
+
+        return Response({'status': 'success'}, status=status.HTTP_201_CREATED)
+
+    except Exception as e:
+        return Response({'error': str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)
*** End Patch